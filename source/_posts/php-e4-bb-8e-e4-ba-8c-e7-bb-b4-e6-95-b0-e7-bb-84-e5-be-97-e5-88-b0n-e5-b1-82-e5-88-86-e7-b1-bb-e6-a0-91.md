---
title: PHP从二维数组得到N层分类树
url: 2072.html
id: 2072
categories:
  - 编程随想
date: 2016-05-25 18:25:09
tags:
---

公司的产品分类存在一张表内，以mid标识其父分类，需要得到有层次结构的数组，以备后续操作。想了下，想了一会儿没想出不去重复读取数据库的方法或者不需要递归的操作。后来看到这个：http://blog.hexu.org/archives/1731.shtml
数据源：（数据要求一维key与对应value二维数组的id要一样）
```php
$items = array(
    1 =&gt; array(&#039;id&#039; =&gt; 1, &#039;pid&#039; =&gt; 0, &#039;name&#039; =&gt; &#039;江西省&#039;),
    2 =&gt; array(&#039;id&#039; =&gt; 2, &#039;pid&#039; =&gt; 0, &#039;name&#039; =&gt; &#039;黑龙江省&#039;),
    3 =&gt; array(&#039;id&#039; =&gt; 3, &#039;pid&#039; =&gt; 1, &#039;name&#039; =&gt; &#039;南昌市&#039;),
    4 =&gt; array(&#039;id&#039; =&gt; 4, &#039;pid&#039; =&gt; 2, &#039;name&#039; =&gt; &#039;哈尔滨市&#039;),
    5 =&gt; array(&#039;id&#039; =&gt; 5, &#039;pid&#039; =&gt; 2, &#039;name&#039; =&gt; &#039;鸡西市&#039;),
    6 =&gt; array(&#039;id&#039; =&gt; 6, &#039;pid&#039; =&gt; 4, &#039;name&#039; =&gt; &#039;香坊区&#039;),
    7 =&gt; array(&#039;id&#039; =&gt; 7, &#039;pid&#039; =&gt; 4, &#039;name&#039; =&gt; &#039;南岗区&#039;),
    8 =&gt; array(&#039;id&#039; =&gt; 8, &#039;pid&#039; =&gt; 6, &#039;name&#039; =&gt; &#039;和兴路&#039;),
    9 =&gt; array(&#039;id&#039; =&gt; 9, &#039;pid&#039; =&gt; 7, &#039;name&#039; =&gt; &#039;西大直街&#039;),
    10 =&gt; array(&#039;id&#039; =&gt; 10, &#039;pid&#039; =&gt; 8, &#039;name&#039; =&gt; &#039;东北林业大学&#039;),
    11 =&gt; array(&#039;id&#039; =&gt; 11, &#039;pid&#039; =&gt; 9, &#039;name&#039; =&gt; &#039;哈尔滨工业大学&#039;),
    12 =&gt; array(&#039;id&#039; =&gt; 12, &#039;pid&#039; =&gt; 8, &#039;name&#039; =&gt; &#039;哈尔滨师范大学&#039;),
    13 =&gt; array(&#039;id&#039; =&gt; 13, &#039;pid&#039; =&gt; 1, &#039;name&#039; =&gt; &#039;赣州市&#039;),
    14 =&gt; array(&#039;id&#039; =&gt; 14, &#039;pid&#039; =&gt; 13, &#039;name&#039; =&gt; &#039;赣县&#039;),
    15 =&gt; array(&#039;id&#039; =&gt; 15, &#039;pid&#039; =&gt; 13, &#039;name&#039; =&gt; &#039;于都县&#039;),
    16 =&gt; array(&#039;id&#039; =&gt; 16, &#039;pid&#039; =&gt; 14, &#039;name&#039; =&gt; &#039;茅店镇&#039;),
    17 =&gt; array(&#039;id&#039; =&gt; 17, &#039;pid&#039; =&gt; 14, &#039;name&#039; =&gt; &#039;大田乡&#039;),
    18 =&gt; array(&#039;id&#039; =&gt; 18, &#039;pid&#039; =&gt; 16, &#039;name&#039; =&gt; &#039;义源村&#039;),
    19 =&gt; array(&#039;id&#039; =&gt; 19, &#039;pid&#039; =&gt; 16, &#039;name&#039; =&gt; &#039;上坝村&#039;),
);
```
生成树的函数：
```php
function genTree9($items) {
    $tree = array(); 
    foreach ($items as $item)
        if (isset($items[$item[&#039;pid&#039;]]))
            $items[$item[&#039;pid&#039;]][&#039;son&#039;][] = &amp;$items[$item[&#039;id&#039;]];
        else
            $tree[] = &amp;$items[$item[&#039;id&#039;]];
    return $tree;
}
```
当然。满足特定条件下的数据，更是可以把函数缩到只有短短5行：
```php
function genTree5($items) { 
    foreach ($items as $item) 
        $items[$item[&#039;pid&#039;]][&#039;son&#039;][$item[&#039;id&#039;]] = &amp;$items[$item[&#039;id&#039;]]; 
    return isset($items[0][&#039;son&#039;]) ? $items[0][&#039;son&#039;] : array(); 
}
```
一遍循环，内存引用。省时又省空间。