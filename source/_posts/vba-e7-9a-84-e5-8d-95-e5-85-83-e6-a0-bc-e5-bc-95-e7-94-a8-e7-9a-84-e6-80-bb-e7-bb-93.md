---
title: vba的单元格引用的总结
tags:
  - EXCEL
  - VBA
url: 1821.html
id: 1821
categories:
  - 编程随想
date: 2013-07-18 10:57:16
---

   初到公司，除了偶尔去工地看看，大多数时间都在办公室帮忙整理资料。频繁使用excel后觉得很有必要好好学学VBA。网上找了点资料开始学习。学习过程中发现，VBA对于单元格的引用有点类似于CSS（其实更像jQuery）的选择器，先引用区域，再对区域进行各项操作。于是乎网上找到了这篇整理好的《vba的单元格引用的总结》。

=====================================================================================

在使用ExcelVBA进行编程时，我们通常需要频繁地引用单元格区域，然后再使用相应的属性和方法对区域进行操作。所谓单元格区域，指的是单个的单元格、或者是由多个单元格组成的区域、或者是整行、整列等。下面，我们设定一些情形，以问答的形式对引用单元格区域的方式进行归纳。
====================================================================================================================================

问题一：在VBA代码中，如何引用当前工作表中的单个单元格(例如引用单元格C3)？  
回答：可以使用下面列举的任一方式对当前工作表中的单元格(C3)进行引用。  
(1) Range("C3")  
(2) \[C3\]  
(3) Cells(3, 3)  
(4) Cells(3, "C")  
(5) Range("C4").Offset(-1)  
Range("D3").Offset(, -1)  
Range("A1").Offset(2, 2)  
(6) 若C3为当前单元格，则可使用：ActiveCell  
(7) 若将C3单元格命名为“Range1”，则可使用：Range("Range1")或\[Range1\]  
(8) Cells(4, 3).Offset(-1)  
(9) Range("A1").Range("C3")
===========================================================================================================================================================================================================================================================================================================================================================================================

问题二：在VBA代码中，我要引用当前工作表中的B2:D6单元格区域，有哪些方式？  
回答：可以使用下面列举的任一方式对当前工作表中单元格区域B2:D6进行引用。  
(1) Range(“B2:D6”)  
(2) Range("B2", "D6")  
(3) \[B2:D6\]  
(4) Range(Range("B2"), Range("D6"))  
(5) Range(Cells(2, 2), Cells(6, 4))  
(6) 若将B2:D6区域命名为“MyRange”，则又可以使用下面的语句引用该区域：  
① Range("MyRange")  
② \[MyRange\]  
(7) Range("B2").Resize(5, 3)  
(8) Range("A1:C5").Offset(1, 1)  
(9) 若单元格B2为当前单元格，则可使用语句：Range(ActiveCell, ActiveCell.Offset(4, 2))  
(10) 若单元格D6为当前单元格，则可使用语句：Range("B2", ActiveCell)
======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

问题三：在VBA代码中，如何使用变量实现对当前工作表中不确定单元格区域的引用？  
回答：有时，我们需要在代码中依次获取工作表中特定区域内的单元格，这通常可以采取下面的几种方式：  
(1) Range(“A” & i)  
(2) Range(“A” & i & “:C” & i)  
(3) Cells(i,1)  
(4) Cells(i,j)  
其中，i、j为变量，在循环语句中指定i和j的范围后，依次获取相应单元格。
=======================================================================================================================================================================================================================

问题四：在VBA代码中，如何扩展引用当前工作表中的单元格区域？  
回答：可以使用Resize属性，例如：  
(1) ActiveCell.Resize(4, 4)，表示自当前单元格开始创建一个4行4列的区域。  
(2) Range("B2").Resize(2, 2)，表示创建B2:C3单元格区域。  
(3) Range("B2").Resize(2)，表示创建B2:B3单元格区域。  
(4) Range("B2").Resize(, 2)，表示创建B2:C2单元格区域。  
如果是在一个单元格区域(如B3:E6)，或一个命名区域中(如将单元格区域B3:E6命名为“MyRange”)使用Resize属性，则只是相对于单元格区域左上角单元格扩展区域，例如：  
代码Range("C3:E6").Resize(, 2)，表示单元格区域C3：D6，并且扩展的单元格区域可不在原单元格区域内。  
因此，可以知道Resize属性是相对于当前活动单元格或某单元格区域中左上角单元格按指定的行数或列数扩展单元格区域。
==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================

问题五：在VBA代码中，如何在当前工作表中基于当前单元格区域或指定单元格区域处理其它单元格区域？  
回答：可以使用Offset属性，例如：  
(1) Range("A1").Offset(2, 2)，表示单元格C3。  
(2) ActiveCell.Offset(, 1)，表示当前单元格下一列的单元格。  
(3) ActiveCell.Offset(1)，表示当前单元格下一行的单元格。  
(4) Range("C3:D5").Offset(, 1)，表示单元格区域D3:E5，即将整个区域偏移一列。  
从上面的代码示例可知，Offset属性从所指定的单元格开始按指定的行数和列数偏移，从而到达目的单元格，但偏移的行数和列数不包括指定单元格本身。
==========================================================================================================================================================================================================================================================================================================================================

问题六：在VBA代码中，如何在当前工作表中引用交叉区域？  
回答：可以使用Intersect方法，例如：  
Intersect(Range("C3:E6"), Range("D5:F8"))，表示单元格区域D5:E6，即单元格区域C3:E6与D5:F8相重迭的区域。
=======================================================================================================================================

问题七：在VBA代码中，如何在当前工作表中引用多个区域？  
回答：  
(1) 可以使用Union方法，例如：  
Union(Range("C3:D4"), Range("E5:F6"))，表示单元格区域C3:D4和E5:F6所组成的区域。  
Union方法可以将多个非连续区域连接起来成为一个区域，从而可以实现对多个非连续区域一起进行操作。  
(2) 也可以使用下面的代码：  
Range("C3:D4, E5:F6")或\[C3:D4, E5:F6\]  
注意：Range("C3:D4", "F5:G6")，表示单元格区域C3:G6，即将两个区域以第一个区域左上角单元格为起点，以第二个区域右下角单元格为终点连接成一个新区域。  
同时，在引用区域后使用Rows属性和Columns属性时，注意下面代码的区别：  
①Range("C3:D4", "F8:G10").Rows.Count，返回的值为8；  
②Range("C3:D4,F8:G10").Rows.Count，返回的值为2，即只计算第一个单元格区域。
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

问题八：在VBA代码中，如何引用当前工作表中活动单元格或指定单元格所在的区域(当前区域)？  
回答：可以使用CurrentRegion属性，例如：  
(1) ActiveCell.CurrentRegion，表示活动单元格所在的当前区域。  
(2) Range("D5").CurrentRegion，表示单元格D5所在的当前区域。  
当前区域是指周围由空行或空列所围成的区域。注：实在弄不明白可以自行在Excel中输入一些数据，然后在这些数据区域上(或这些数据周边)按ctrl+shift+* 可选择到CurrentRegion的区域。
=================================================================================================================================================================================================================================================================================

问题九：在VBA代码中，如何引用当前工作表中已使用的区域？  
回答：可以使用UsedRange属性，例如：  
(1) Activesheet.UsedRange，表示当前工作表中已使用的区域。  
(2) Worksheets("sheet1").UsedRange，表示工作表sheet1中已使用的区域。  
与CurrentRegion属性不同的是，该属性代表工作表中已使用的单元格区域，包括显示为空行，但已进行过格式的单元格区域。
============================================================================================================================================================================================================================

问题十：如何在单元格区域内指定特定的单元格？  
回答：可以使用Item属性，例如：  
(1) Range("A1:B10").Item(5,3)指定单元格C5，这个单元格处于以区域中左上角单元格A1(即区域中第1行第1列的单元格)为起点的第5行第3列。因为Item属性为默认属性，因此也可以简写为：Range("A1:B10")(5,3)。  
如果将A1:B10区域命名为”MyRange”，那么Range("MyRange")(5,3)也指定单元格C5。  
(2) Range("A1:B10")(12,13)指定单元格M12，即用这种方式引用单元格，该单元格不必一定要包含在区域内。  
同时，也不需要索引数值是正值，例如：  
① Range("D4:F6")(0,0)代表单元格C3；  
② Range("D4:F6")(-1,-2)代表单元格A2。  
而Range("D4:F6")(1,1)代表单元格D4。  
(3) 也可以在单元格区域中循环，例如：  
Range("D4:F6")(2,2)(3,4)代表单元格H7，即该单元格位于作为左上角单元格E5的第3行第4列(因为E5是开始于区域中左上角单元格D4起的第2行第2列)。  
(4) 也能使用一个单个的索引数值进行引用。计数方式为从左向右，即在区域中的第一行开始从左向右计数，第一行结束后，然后从第二行开始从左到右接着计数，依次类推。(注：从区域中第一行第一个单元格开始计数，当第一行结束时，转入第二行最左边的单元格，这样按一行一行从左向右依次计数。以单元格区域中第1个单元格开始，按上述规则依次为第2个单元格、第3个单元格….等等)，例如：  
Range("A1:B2")(1) 代表单元格A1；  
Range("A1:B2")(2) 代表单元格B1；  
Range("A1:B2")(3) 代表单元格A2；  
Range("A1:B2")(4) 代表单元格B2。  
这种方法可在工作表中连续向下引用单元格(即不一定是在单元格区域内，但在遵循相同的规律)，例如：  
Range("A1:B2")(5)代表单元格A3；  
Range("A1:B2")(14)代表单元格B7，等等。  
也可以使用单个的负数索引值。  
这种使用单个索引值的方法对遍历列是有用的，例如，Range("D4")(1)代表单元格D4，Range("D4")(2)代表单元格D5，Range ("D4")(11)代表单元格D14，等等。  
同理，稍作调整后也可遍历行，例如：  
Range("D4").Columns(2)代表单元格E4，Range("D4").Columns(5)指定单元格H4，等等。  
(5)当与对象变量配合使用时，Item属性能提供简洁并有效的代码，例如：  
Set rng = Worksheets(1).\[a1\]  
定义了对象变量后，像单元格方法一样，Item属性允许使用两个索引数值引用工作表中的任一单元格，例如，rng(3,4)指定单元格D3。
==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

问题十一：在VBA代码中，如何引用当前工作表中的整行或整列？  
回答：见下面的示例代码：  
(1) Range("C:C").Select，表示选择C列。  
  Range("C:E").Select，表示选择C列至E列。  
(2) Range("1:1").Select，表示选择第一行。  
  Range("1:3").Select，表示选择第1行至第3行。  
(3) Range("C:C").EntireColumn，表示C列；  
  Range("D1").EntireColumn，表示D列。  
同样的方式，也可以选择整行，然后可以使用如AutoFit方法对整列或整行进行调整。
===============================================================================================================================================================================================================================================================================================================

问题十二：在VBA代码中，如何引用当前工作表中的所有单元格？  
回答：可以使用下面的代码：  
(1) Cells，表示当前工作表中的所有单元格。  
(2) Range(Cells(1, 1), Cells(Cells.Rows.Count, Cells. Columns.Count))，其中Cells.Rows表示工作表所有行，Cells. Columns表示工作表所有列。
===============================================================================================================================================================================================

问题十三：在VBA代码中，如何引用工作表中的特定单元格区域？  
回答：在工作表中，您可能使用过“定位条件”对话框。可以通过选择菜单“编辑——定位”，单击“定位”对话框中的“定位条件”按钮显示该对话框。这个对话框可以允许用户选择特定的单元格。例如：  
(1) Worksheets("sheet1").Cells.SpecialCells(xlCellTypeAllFormatConditions)，表示工作表sheet1中由带有条件格式的单元格所组成的区域。  
(2) ActiveCell.CurrentRegion.SpecialCells(xlCellTypeBlanks)，表示当前工作表中活动单元格所在区域中所有空白单元格所组成的区域。  
当然，还有很多常量和值的组合，可以让您实现特定单元格的查找并引用。
===========================================================================================================================================================================================================================================================================================================================================================================

问题十四：在VBA代码中，如何引用其它工作表或其它工作簿中的单元格区域？  
回答：要引用其它工作表或其它工作簿中的单元格区域，只需在单元格对象前加上相应的引用对象即可，例如：  
(1) Worksheets(“Sheet3”).Range(“C3:D5”)，表示引用工作表sheet3中的单元格区域C3:D5。  
(2) Workbooks(“MyBook.xls”).Worksheets(“sheet1”).Range(“B2”)，表示引用MyBook工作簿中工作表Sheet1上的单元格B2。
============================================================================================================================================================================================================================================================

问题十五：还有其它的一些情形吗？  
回答：列举如下：  
(1) Cells(15)，表示单元格O1，即可在Cells属性中指定单元格数字来选择单元格，其计数顺序为自左至右、从上到下，又如Cells(257)，表示单元格B1。  
(2) Cells(, 256)，表示单元格IV1，但是如果Cells(, 257)，则会返回错误。
=======================================================================================================================================================================

[VIA](http://www.cnblogs.com/liudong/archive/2008/06/11/1217186.html "原文链接")

![](http://ww4.sinaimg.cn/large/6d1c4ea2gw1e6qsi3t94yj20c606waa0.jpg)